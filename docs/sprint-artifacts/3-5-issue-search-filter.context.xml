<?xml version="1.0" encoding="UTF-8"?>
<!--
  Story Context: 3-5-issue-search-filter
  Generated: 2025-11-29
  Epic: 3 - ν”„λ΅μ νΈ & μ΄μ κ΄€λ¦¬
  FR Coverage: FR-036
-->
<story-context story-key="3-5-issue-search-filter" epic="3">
  <meta>
    <title>μ΄μ κ²€μƒ‰ &amp; ν•„ν„°λ§</title>
    <status>drafted</status>
    <fr-coverage>FR-036</fr-coverage>
    <depends-on>3-3-issue-create-list, 3-4-issue-detail-edit</depends-on>
  </meta>

  <!-- ============================================
       SECTION 1: PRD Requirements
       ============================================ -->
  <prd-requirements>
    <requirement id="FR-036" priority="P1">
      <title>μ΄μ κ²€μƒ‰ &amp; ν•„ν„°λ§</title>
      <description>
        - μ λ© κΈ°μ¤€ μ‹¤μ‹κ°„ κ²€μƒ‰ (λ””λ°”μ΄μ¤ 300ms)
        - μƒνƒλ³„ ν•„ν„°λ§ (λ³µμ μ„ νƒ)
        - μ°μ„ μμ„λ³„ ν•„ν„°λ§ (λ³µμ μ„ νƒ)
        - λ‹΄λ‹Ήμλ³„ ν•„ν„°λ§
        - λΌλ²¨λ³„ ν•„ν„°λ§ (λ³µμ μ„ νƒ)
        - λ§κ°μΌ λ²”μ„ ν•„ν„°λ§
        - λ³µν•© ν•„ν„° AND μ΅°κ±΄ κ²°ν•©
        - ν•„ν„° μƒνƒ URL μΏΌλ¦¬ νλΌλ―Έν„° λ°μ
        - URL κ³µμ  μ‹ ν•„ν„° μƒνƒ λ³µμ›
        - μ •λ ¬ μµμ… (μƒμ„±μΌ, μμ •μΌ, μ°μ„ μμ„, λ§κ°μΌ)
        - ν•„ν„° μ΄κΈ°ν™” λ²„νΌ
      </description>
    </requirement>
  </prd-requirements>

  <!-- ============================================
       SECTION 2: Architecture Context
       ============================================ -->
  <architecture>
    <api-extension>
      <endpoint path="GET /api/projects/[projectId]/issues">
        <query-params>
          <param name="search" type="string">μ λ© κ²€μƒ‰ (ILIKE)</param>
          <param name="status" type="string">μƒνƒ ID (μ‰Όν‘ κµ¬λ¶„)</param>
          <param name="priority" type="string">μ°μ„ μμ„ (μ‰Όν‘ κµ¬λ¶„: HIGH,MEDIUM,LOW)</param>
          <param name="assignee" type="string">λ‹΄λ‹Ήμ UUID λλ” 'unassigned'</param>
          <param name="label" type="string">λΌλ²¨ UUID (μ‰Όν‘ κµ¬λ¶„)</param>
          <param name="dueDateFrom" type="string">λ§κ°μΌ μ‹μ‘ (YYYY-MM-DD)</param>
          <param name="dueDateTo" type="string">λ§κ°μΌ λ (YYYY-MM-DD)</param>
          <param name="sortBy" type="string">μ •λ ¬ ν•„λ“: createdAt|updatedAt|priority|dueDate</param>
          <param name="sortOrder" type="string">μ •λ ¬ μμ„: asc|desc</param>
        </query-params>
      </endpoint>
    </api-extension>

    <sql-query-pattern><![CDATA[
SELECT i.*, s.name as status_name, p.name as assignee_name
FROM issues i
LEFT JOIN statuses s ON i.status_id = s.id
LEFT JOIN profiles p ON i.assignee_id = p.id
WHERE i.project_id = $1
  AND i.deleted_at IS NULL
  AND i.title ILIKE '%' || $search || '%'     -- κ²€μƒ‰
  AND i.status_id = ANY($statusIds)            -- μƒνƒ ν•„ν„°
  AND i.priority = ANY($priorities)            -- μ°μ„ μμ„ ν•„ν„°
  AND (i.assignee_id = $assignee OR ($assignee = 'unassigned' AND i.assignee_id IS NULL))
  AND i.id IN (                                -- λΌλ²¨ ν•„ν„°
    SELECT issue_id FROM issue_labels WHERE label_id = ANY($labelIds)
  )
  AND i.due_date BETWEEN $dueDateFrom AND $dueDateTo
ORDER BY
  CASE WHEN $sortBy = 'priority' THEN
    CASE i.priority WHEN 'HIGH' THEN 1 WHEN 'MEDIUM' THEN 2 WHEN 'LOW' THEN 3 END
  END,
  CASE WHEN $sortBy = 'createdAt' THEN i.created_at END,
  CASE WHEN $sortBy = 'updatedAt' THEN i.updated_at END,
  CASE WHEN $sortBy = 'dueDate' THEN i.due_date END
$sortOrder
LIMIT $limit OFFSET $offset;
    ]]></sql-query-pattern>

    <state-management>
      <store name="filter-store" library="Zustand">
        <state>
          <field name="search" type="string" default=""/>
          <field name="statuses" type="string[]" default="[]"/>
          <field name="priorities" type="string[]" default="[]"/>
          <field name="assignee" type="string | null" default="null"/>
          <field name="labels" type="string[]" default="[]"/>
          <field name="dueDateFrom" type="string | null" default="null"/>
          <field name="dueDateTo" type="string | null" default="null"/>
          <field name="sortBy" type="string" default="createdAt"/>
          <field name="sortOrder" type="string" default="desc"/>
        </state>
        <actions>
          <action name="setSearch"/>
          <action name="setStatuses"/>
          <action name="setPriorities"/>
          <action name="setAssignee"/>
          <action name="setLabels"/>
          <action name="setDateRange"/>
          <action name="setSortBy"/>
          <action name="setSortOrder"/>
          <action name="resetFilters"/>
        </actions>
      </store>
    </state-management>

    <url-sync-pattern>
      <hook>useSearchParams (Next.js App Router)</hook>
      <behavior>
        - ν•„ν„° λ³€κ²½ μ‹ URL μΏΌλ¦¬ νλΌλ―Έν„° μ—…λ°μ΄νΈ
        - νμ΄μ§€ λ΅λ“ μ‹ URLμ—μ„ ν•„ν„° λ³µμ›
        - λΈλΌμ°μ € λ’¤λ΅κ°€κΈ°/μ•μΌλ΅κ°€κΈ° μ§€μ›
      </behavior>
      <url-format><![CDATA[
/projects/[projectId]?
  search=bug&
  status=uuid1,uuid2&
  priority=HIGH,MEDIUM&
  assignee=user-uuid&
  label=label-uuid1,label-uuid2&
  dueDateFrom=2025-01-01&
  dueDateTo=2025-01-31&
  sortBy=priority&
  sortOrder=desc
      ]]></url-format>
    </url-sync-pattern>
  </architecture>

  <!-- ============================================
       SECTION 3: UX Design Specification
       ============================================ -->
  <ux-design source="docs/ux-design-specification.md">
    <filter-bar-layout>
      <ascii-diagram><![CDATA[
+--------------------------------------------------------------------+
| [π” Search issues...]  [Status β–Ύ] [Priority β–Ύ] [Assignee β–Ύ]        |
| [Labels β–Ύ] [Due Date β–Ύ] [Sort: Created β–Ύ]           [Clear All]    |
+--------------------------------------------------------------------+

μ μ©λ ν•„ν„° Chips:
+--------------------------------------------------------------------+
| Filters: [Status: In Progress Γ—] [Priority: HIGH Γ—] [Clear all]    |
+--------------------------------------------------------------------+
      ]]></ascii-diagram>
    </filter-bar-layout>

    <search-bar>
      <debounce-ms>300</debounce-ms>
      <placeholder>Search issues...</placeholder>
      <icon>Lucide Search</icon>
      <clear-button>X μ•„μ΄μ½μΌλ΅ κ²€μƒ‰μ–΄ μ§€μ°κΈ°</clear-button>
    </search-bar>

    <filter-dropdowns>
      <dropdown name="Status">
        <type>Multi-select Checkbox</type>
        <options>ν”„λ΅μ νΈ μƒνƒ λ©λ΅ (Backlog, In Progress, Review, Done, + μ»¤μ¤ν…€)</options>
      </dropdown>
      <dropdown name="Priority">
        <type>Multi-select Chips</type>
        <options>HIGH, MEDIUM, LOW (μƒ‰μƒ μ μ©)</options>
      </dropdown>
      <dropdown name="Assignee">
        <type>Searchable Single Select</type>
        <options>ν€ λ©¤λ²„ λ©λ΅ + "Unassigned"</options>
        <display>μ•„λ°”νƒ€ + μ΄λ¦„</display>
      </dropdown>
      <dropdown name="Labels">
        <type>Multi-select Chips</type>
        <options>ν”„λ΅μ νΈ λΌλ²¨ λ©λ΅ (μƒ‰μƒ μ μ©)</options>
      </dropdown>
      <dropdown name="Due Date">
        <type>Date Range Picker</type>
        <presets>Today, This Week, This Month, Overdue, Custom Range</presets>
      </dropdown>
    </filter-dropdowns>

    <sort-dropdown>
      <options>
        <option value="createdAt">Created Date</option>
        <option value="updatedAt">Updated Date</option>
        <option value="priority">Priority</option>
        <option value="dueDate">Due Date</option>
      </options>
      <toggle>Ascending / Descending</toggle>
    </sort-dropdown>

    <color-theme>
      <filter-button>bg-zinc-100 border border-zinc-200</filter-button>
      <active-filter>bg-indigo-100 text-indigo-700 border-indigo-200</active-filter>
      <clear-all>text-zinc-500 hover:text-zinc-700</clear-all>
      <filter-badge>bg-indigo-500 text-white (ν•„ν„° κ°μ ν‘μ‹)</filter-badge>
    </color-theme>
  </ux-design>

  <!-- ============================================
       SECTION 4: Existing Codebase Context
       ============================================ -->
  <existing-code>
    <hooks-from-story-3-3>
      <hook path="hooks/use-issues.ts">useIssues ν›… ν™•μ¥ ν•„μ”</hook>
      <hook path="hooks/use-labels.ts">useLabels (λΌλ²¨ ν•„ν„° μµμ…)</hook>
    </hooks-from-story-3-3>

    <hooks-from-story-3-4>
      <hook path="hooks/use-team-members.ts">useTeamMembers (λ‹΄λ‹Ήμ ν•„ν„° μµμ…)</hook>
    </hooks-from-story-3-4>

    <ui-components>
      <component path="components/ui/select.tsx">Select (μ •λ ¬, λ‹¨μΌ μ„ νƒ ν•„ν„°)</component>
      <component path="components/ui/button.tsx">Button (Clear All)</component>
      <component path="components/ui/input.tsx">Input (κ²€μƒ‰ λ°”)</component>
      <component path="components/ui/checkbox.tsx">Checkbox (λ‹¤μ¤‘ μ„ νƒ ν•„ν„°)</component>
      <component path="components/ui/dropdown-menu.tsx">DropdownMenu (ν•„ν„° λ“λ΅­λ‹¤μ΄)</component>
    </ui-components>

    <component-pattern path="components/ui/priority-badge.tsx">
      <reuse>μ°μ„ μμ„ ν•„ν„° Chipμ— μƒ‰μƒ μ μ©</reuse>
    </component-pattern>

    <component-pattern path="components/ui/label-tag.tsx">
      <reuse>λΌλ²¨ ν•„ν„° Chipμ— μƒ‰μƒ μ μ©</reuse>
    </component-pattern>
  </existing-code>

  <!-- ============================================
       SECTION 5: Files to Create
       ============================================ -->
  <files-to-create>
    <api>
      <file path="app/api/projects/[projectId]/issues/route.ts" mode="extend">
        <add>GET λ©”μ„λ“μ— ν•„ν„°λ§/μ •λ ¬ μΏΌλ¦¬ νλΌλ―Έν„° μ²λ¦¬ μ¶”κ°€</add>
      </file>
    </api>

    <stores>
      <file path="stores/filter-store.ts">
        <purpose>Zustand ν•„ν„° μƒνƒ μ¤ν† μ–΄</purpose>
        <exports>
          <store name="useFilterStore">
            <state>search, statuses, priorities, assignee, labels, dueDateFrom, dueDateTo, sortBy, sortOrder</state>
            <actions>setSearch, setStatuses, setPriorities, setAssignee, setLabels, setDateRange, setSortBy, setSortOrder, resetFilters</actions>
          </store>
        </exports>
      </file>
    </stores>

    <hooks>
      <file path="hooks/use-debounce.ts">
        <purpose>λ””λ°”μ΄μ¤ μ»¤μ¤ν…€ ν›…</purpose>
        <usage>κ²€μƒ‰ μ…λ ¥μ— 300ms λ””λ°”μ΄μ¤ μ μ©</usage>
      </file>
      <file path="hooks/use-filter-sync.ts">
        <purpose>URL μΏΌλ¦¬ νλΌλ―Έν„°μ™€ ν•„ν„° μ¤ν† μ–΄ λ™κΈ°ν™”</purpose>
        <features>
          <feature>ν•„ν„° λ³€κ²½ β†’ URL μ—…λ°μ΄νΈ</feature>
          <feature>νμ΄μ§€ λ΅λ“ β†’ URLμ—μ„ ν•„ν„° λ³µμ›</feature>
        </features>
      </file>
      <file path="hooks/use-issues.ts" mode="extend">
        <add>ν•„ν„° νλΌλ―Έν„°λ¥Ό μΏΌλ¦¬ ν‚¤μ— ν¬ν•¨, ν•„ν„° λ³€κ²½ μ‹ μλ™ μ¬μ΅°ν</add>
      </file>
    </hooks>

    <components>
      <file path="components/issues/search-bar.tsx">
        <purpose>κ²€μƒ‰ λ°” μ»΄ν¬λ„νΈ</purpose>
        <features>
          <feature>κ²€μƒ‰ μ•„μ΄μ½</feature>
          <feature>μ…λ ¥ ν•„λ“ (placeholder: "Search issues...")</feature>
          <feature>λ””λ°”μ΄μ¤ 300ms</feature>
          <feature>κ²€μƒ‰μ–΄ μ§€μ°κΈ° X λ²„νΌ</feature>
        </features>
      </file>
      <file path="components/issues/filter-bar.tsx">
        <purpose>ν•„ν„° λ°” μ»¨ν…μ΄λ„</purpose>
        <children>
          <child>SearchBar</child>
          <child>StatusFilter</child>
          <child>PriorityFilter</child>
          <child>AssigneeFilter</child>
          <child>LabelFilter</child>
          <child>DateRangeFilter</child>
          <child>SortDropdown</child>
          <child>ClearAllButton</child>
        </children>
      </file>
      <file path="components/issues/status-filter.tsx">
        <purpose>μƒνƒ Multi-select ν•„ν„°</purpose>
      </file>
      <file path="components/issues/priority-filter.tsx">
        <purpose>μ°μ„ μμ„ Multi-select ν•„ν„°</purpose>
        <visual>PriorityBadge μƒ‰μƒ μ μ©</visual>
      </file>
      <file path="components/issues/assignee-filter.tsx">
        <purpose>λ‹΄λ‹Ήμ Single-select ν•„ν„°</purpose>
        <visual>Avatar + μ΄λ¦„</visual>
      </file>
      <file path="components/issues/label-filter.tsx">
        <purpose>λΌλ²¨ Multi-select ν•„ν„°</purpose>
        <visual>LabelTag μƒ‰μƒ μ μ©</visual>
      </file>
      <file path="components/issues/date-range-filter.tsx">
        <purpose>λ§κ°μΌ λ²”μ„ ν•„ν„°</purpose>
        <presets>Today, This Week, This Month, Overdue</presets>
      </file>
      <file path="components/issues/sort-dropdown.tsx">
        <purpose>μ •λ ¬ λ“λ΅­λ‹¤μ΄</purpose>
        <options>Created, Updated, Priority, Due Date</options>
        <toggle>ASC/DESC</toggle>
      </file>
      <file path="components/issues/active-filters.tsx">
        <purpose>μ μ©λ ν•„ν„° Chip ν‘μ‹</purpose>
        <features>
          <feature>κ° ν•„ν„°λ¥Ό ChipμΌλ΅ ν‘μ‹</feature>
          <feature>X ν΄λ¦­μΌλ΅ κ°λ³„ μ κ±°</feature>
          <feature>Clear All λ²„νΌ</feature>
        </features>
      </file>
    </components>
  </files-to-create>

  <!-- ============================================
       SECTION 6: Acceptance Criteria Checklist
       ============================================ -->
  <acceptance-criteria>
    <ac id="1" status="pending">κ²€μƒ‰μ–΄ μ…λ ¥ μ‹ μ΄μ μ λ© κΈ°μ¤€ μ‹¤μ‹κ°„ ν•„ν„°λ§</ac>
    <ac id="2" status="pending">κ²€μƒ‰μ— λ””λ°”μ΄μ¤(300ms) μ μ©</ac>
    <ac id="3" status="pending">μƒνƒλ³„ ν•„ν„°λ§ (λ³µμ μ„ νƒ)</ac>
    <ac id="4" status="pending">μ°μ„ μμ„λ³„ ν•„ν„°λ§ (λ³µμ μ„ νƒ)</ac>
    <ac id="5" status="pending">λ‹΄λ‹Ήμλ³„ ν•„ν„°λ§</ac>
    <ac id="6" status="pending">λΌλ²¨λ³„ ν•„ν„°λ§ (λ³µμ μ„ νƒ)</ac>
    <ac id="7" status="pending">λ§κ°μΌ λ²”μ„ ν•„ν„°λ§</ac>
    <ac id="8" status="pending">λ³µν•© ν•„ν„° AND μ΅°κ±΄ κ²°ν•©</ac>
    <ac id="9" status="pending">ν•„ν„° μƒνƒ URL μΏΌλ¦¬ νλΌλ―Έν„° λ°μ</ac>
    <ac id="10" status="pending">URL κ³µμ  μ‹ λ™μΌν• ν•„ν„° μƒνƒ λ³µμ›</ac>
    <ac id="11" status="pending">μ •λ ¬ μµμ… μ κ³µ</ac>
    <ac id="12" status="pending">ν•„ν„° μ΄κΈ°ν™” λ²„νΌ</ac>
  </acceptance-criteria>

  <!-- ============================================
       SECTION 7: Dependencies
       ============================================ -->
  <dependencies>
    <story-dependency id="3-3-issue-create-list" status="drafted" required="true">
      μ΄μ λ©λ΅ API, useIssues ν›…
    </story-dependency>
    <story-dependency id="3-4-issue-detail-edit" status="drafted">
      useTeamMembers ν›…
    </story-dependency>
    <package-dependency name="zustand" version="^4.x">ν•„ν„° μƒνƒ κ΄€λ¦¬</package-dependency>
    <package-dependency name="date-fns" version="^3.x">λ‚ μ§ λ²”μ„ κ³„μ‚°</package-dependency>
  </dependencies>
</story-context>
