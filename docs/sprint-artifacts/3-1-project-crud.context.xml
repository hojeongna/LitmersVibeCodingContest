<story-context id="3-1-project-crud" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>1</storyId>
    <title>프로젝트 CRUD</title>
    <status>drafted</status>
    <generatedAt>2025-11-29</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/3-1-project-crud.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>팀 멤버</asA>
    <iWant>팀 내에서 프로젝트를 생성, 조회, 수정, 삭제할 수 있기를 원합니다</iWant>
    <soThat>팀의 이슈들을 프로젝트별로 체계적으로 관리할 수 있습니다</soThat>
    <tasks>
      <taskGroup n="1" title="데이터베이스 및 API 기반" acs="#1, #2, #8">
        <task id="1.1">프로젝트 생성 API 구현 - POST /api/projects, Zod 검증, 팀당 15개 제한</task>
        <task id="1.2">프로젝트 목록 조회 API 구현 - GET /api/projects, 팀 멤버십 검증, 즐겨찾기 정렬</task>
        <task id="1.3">프로젝트 상세 조회 API 구현 - GET /api/projects/[projectId], 이슈 통계 포함</task>
        <task id="1.4">프로젝트 수정 API 구현 - PUT /api/projects/[projectId], 권한 검증</task>
        <task id="1.5">프로젝트 삭제 API 구현 - DELETE /api/projects/[projectId], Soft Delete</task>
      </taskGroup>
      <taskGroup n="2" title="UI 컴포넌트 구현" acs="#3, #4, #9">
        <task id="2.1">CreateProjectModal 구현 - react-hook-form + zod, 팀 선택 드롭다운</task>
        <task id="2.2">Sidebar ProjectList 구현 - 팀별 그룹화, 프로젝트별 컬러 도트</task>
        <task id="2.3">프로젝트 목록 페이지 구현 - 그리드/리스트, 프로젝트 카드</task>
      </taskGroup>
      <taskGroup n="3" title="프로젝트 상세 페이지" acs="#5, #10">
        <task id="3.1">프로젝트 상세 페이지 레이아웃 - 헤더, 통계 카드, 탭 구조</task>
        <task id="3.2">프로젝트 설정 페이지 - 수정 폼, Danger Zone 삭제</task>
      </taskGroup>
      <taskGroup n="4" title="권한 검증 및 보안" acs="#6, #7">
        <task id="4.1">checkProjectPermission 유틸리티 - OWNER, ADMIN, 프로젝트 소유자 검증</task>
      </taskGroup>
      <taskGroup n="5" title="테스트" acs="All">
        <task id="5.1">API 테스트 - CRUD, 멤버십 검증, 권한 검증, 15개 제한</task>
      </taskGroup>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1" fr="FR-020">로그인한 사용자는 자신이 소속된 팀 내에 새 프로젝트를 생성할 수 있어야 한다 (이름 필수 1~100자, 설명 선택 최대 2000자)</ac>
    <ac id="2" fr="FR-020">팀당 최대 15개 프로젝트 제한이 적용되어야 한다</ac>
    <ac id="3" fr="FR-021">사용자는 자신이 속한 팀의 프로젝트 전체 목록을 조회할 수 있어야 한다 (이름, 설명 요약, 이슈 개수, 생성일 표시)</ac>
    <ac id="4" fr="FR-021">프로젝트 목록은 즐겨찾기 프로젝트 우선, 이후 생성일 역순으로 정렬되어야 한다</ac>
    <ac id="5" fr="FR-022">프로젝트 상세 페이지에서 프로젝트 정보(이름, 설명)와 이슈 통계(상태별 개수)를 표시해야 한다</ac>
    <ac id="6" fr="FR-023">팀 OWNER, ADMIN, 또는 프로젝트 소유자만 프로젝트 이름과 설명을 수정할 수 있어야 한다</ac>
    <ac id="7" fr="FR-024">팀 OWNER, ADMIN, 또는 프로젝트 소유자만 프로젝트를 삭제할 수 있어야 한다</ac>
    <ac id="8" fr="FR-024, FR-071">프로젝트 삭제 시 하위 이슈, 댓글 등 모두 Soft Delete 처리되어야 한다</ac>
    <ac id="9" fr="FR-021">Sidebar에서 팀별로 그룹화된 프로젝트 목록이 표시되어야 한다</ac>
    <ac id="10" fr="FR-020">프로젝트 생성 후 해당 프로젝트 페이지로 자동 이동해야 한다</ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/prd.md</path>
        <title>Jira Lite MVP PRD</title>
        <section>3.3 프로젝트 (Project) - FR-020~027</section>
        <snippet>프로젝트 CRUD, 아카이브, 즐겨찾기 요구사항 정의. 팀당 최대 15개 프로젝트 제한.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Database Schema - projects 테이블</section>
        <snippet>projects 테이블 구조, RLS 정책, API 응답 형식 정의. Supabase PostgreSQL 기반.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic 3 Technical Specification</title>
        <section>APIs and Interfaces - 프로젝트 API</section>
        <snippet>프로젝트 CRUD API 상세 스펙, 데이터 모델, Acceptance Criteria 매핑.</snippet>
      </doc>
      <doc>
        <path>docs/ux-color-themes.html</path>
        <title>Color Theme Visualizer</title>
        <section>Linear Productivity Theme</section>
        <snippet>Primary: #5B5FC7 (Indigo), Accent: #3B82F6 (Blue), Surface: #FFFFFF, Border: #E4E4E7. 버튼, 카드, 폼 인풋 스타일 정의.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-directions.html</path>
        <title>Design Direction Mockups</title>
        <section>Sidebar 프로젝트 목록</section>
        <snippet>Sidebar 240px 너비, 다크 배경(#18181B), 프로젝트별 컬러 도트, 활성 프로젝트 하이라이트. 팀/프로젝트 계층 구조 UI.</snippet>
      </doc>
    </docs>

    <code>
      <file>
        <path>jira-lite-mvp/components/ui/button.tsx</path>
        <kind>component</kind>
        <symbol>Button, buttonVariants</symbol>
        <reason>프로젝트 생성/수정/삭제 버튼에 사용할 기존 Button 컴포넌트</reason>
      </file>
      <file>
        <path>jira-lite-mvp/components/ui/card.tsx</path>
        <kind>component</kind>
        <symbol>Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter</symbol>
        <reason>프로젝트 카드 및 통계 카드 UI에 사용할 기존 Card 컴포넌트</reason>
      </file>
      <file>
        <path>jira-lite-mvp/components/ui/input.tsx</path>
        <kind>component</kind>
        <symbol>Input</symbol>
        <reason>프로젝트 이름/설명 입력 폼에 사용할 기존 Input 컴포넌트</reason>
      </file>
      <file>
        <path>jira-lite-mvp/components/ui/label.tsx</path>
        <kind>component</kind>
        <symbol>Label</symbol>
        <reason>폼 필드 라벨에 사용</reason>
      </file>
      <file>
        <path>jira-lite-mvp/lib/utils.ts</path>
        <kind>utility</kind>
        <symbol>cn</symbol>
        <reason>클래스명 병합 유틸리티</reason>
      </file>
      <file>
        <path>jira-lite-mvp/app/protected/layout.tsx</path>
        <kind>layout</kind>
        <symbol>default export</symbol>
        <reason>인증된 사용자용 레이아웃 - Sidebar 추가 위치</reason>
      </file>
    </code>

    <dependencies>
      <npm>
        <package name="@supabase/supabase-js" version="latest">Supabase 클라이언트 - DB 접근</package>
        <package name="@supabase/ssr" version="latest">Supabase SSR - 서버 컴포넌트용</package>
        <package name="react-hook-form" version="^7.67.0">폼 상태 관리</package>
        <package name="@hookform/resolvers" version="^5.2.2">zod 리졸버</package>
        <package name="zod" version="^4.1.13">스키마 유효성 검증</package>
        <package name="@tanstack/react-query" version="^5.90.11">서버 상태 캐싱</package>
        <package name="zustand" version="^5.0.8">클라이언트 상태 관리</package>
        <package name="lucide-react" version="^0.511.0">아이콘</package>
      </npm>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint source="docs/architecture.md">API Response Format: { success: true, data: {...} } 또는 { success: false, error: { code, message } }</constraint>
    <constraint source="docs/prd.md#FR-070">모든 API에서 팀 멤버십 검증 필수</constraint>
    <constraint source="docs/architecture.md">Soft Delete: deleted_at 필드 사용, 조회 시 deleted_at IS NULL 조건</constraint>
    <constraint source="docs/prd.md#FR-020">팀당 최대 15개 프로젝트 제한</constraint>
    <constraint source="docs/prd.md#FR-020">프로젝트 이름: 1~100자, 설명: 최대 2000자</constraint>
    <constraint source="CLAUDE.md">파일명: kebab-case, 컴포넌트: PascalCase, API Route: kebab-case</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>POST /api/projects</name>
      <kind>REST endpoint</kind>
      <signature>{ name: string (1~100), description?: string (max 2000), teamId: string } => { success: true, data: Project } | { success: false, error }</signature>
      <path>jira-lite-mvp/app/api/projects/route.ts (생성 예정)</path>
    </interface>
    <interface>
      <name>GET /api/projects</name>
      <kind>REST endpoint</kind>
      <signature>?teamId=... => { success: true, data: Project[] }</signature>
      <path>jira-lite-mvp/app/api/projects/route.ts (생성 예정)</path>
    </interface>
    <interface>
      <name>GET /api/projects/[projectId]</name>
      <kind>REST endpoint</kind>
      <signature>=> { success: true, data: Project & { issueStats } }</signature>
      <path>jira-lite-mvp/app/api/projects/[projectId]/route.ts (생성 예정)</path>
    </interface>
    <interface>
      <name>PUT /api/projects/[projectId]</name>
      <kind>REST endpoint</kind>
      <signature>{ name?, description? } => { success: true, data: Project }</signature>
      <path>jira-lite-mvp/app/api/projects/[projectId]/route.ts (생성 예정)</path>
    </interface>
    <interface>
      <name>DELETE /api/projects/[projectId]</name>
      <kind>REST endpoint</kind>
      <signature>=> { success: true }</signature>
      <path>jira-lite-mvp/app/api/projects/[projectId]/route.ts (생성 예정)</path>
    </interface>
    <interface>
      <name>projects 테이블 RLS 정책</name>
      <kind>database policy</kind>
      <signature>team_id IN (SELECT team_id FROM team_members WHERE user_id = auth.uid()) AND deleted_at IS NULL</signature>
      <path>supabase/migrations/ (참조)</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      프로젝트는 Chrome DevTools MCP를 사용한 E2E 테스트와 수동 테스트를 진행합니다.
      API 테스트는 Supabase 클라이언트 직접 호출 또는 Next.js API Route 호출로 수행합니다.
      유효성 검증 로직은 Zod 스키마로 정의하며, 클라이언트와 서버에서 동일한 스키마를 사용합니다.
    </standards>
    <locations>
      <location>jira-lite-mvp/app/api/projects/** (API Routes)</location>
      <location>jira-lite-mvp/lib/validations/project.ts (Zod 스키마)</location>
    </locations>
    <ideas>
      <idea acRefs="1">유효한 입력으로 프로젝트 생성 성공</idea>
      <idea acRefs="1">필수 필드(name) 누락 시 400 에러</idea>
      <idea acRefs="1">name 100자 초과 시 400 에러</idea>
      <idea acRefs="2">팀에 15개 프로젝트 존재 시 추가 생성 실패</idea>
      <idea acRefs="3">팀 멤버가 프로젝트 목록 조회 성공</idea>
      <idea acRefs="3">타 팀 멤버 접근 시 빈 배열 또는 403</idea>
      <idea acRefs="4">즐겨찾기 프로젝트가 목록 상단에 정렬</idea>
      <idea acRefs="5">프로젝트 상세에서 이슈 통계 포함 확인</idea>
      <idea acRefs="6, 7">OWNER/ADMIN/소유자가 수정/삭제 성공</idea>
      <idea acRefs="6, 7">일반 MEMBER가 수정/삭제 시 403 에러</idea>
      <idea acRefs="8">삭제 후 deleted_at 필드 설정 확인</idea>
      <idea acRefs="8">삭제된 프로젝트 목록에서 제외 확인</idea>
      <idea acRefs="9">Sidebar에서 팀별 그룹화 표시</idea>
      <idea acRefs="10">생성 후 /projects/[newId] 리다이렉트</idea>
    </ideas>
  </tests>

  <uxTheme>
    <!-- Linear Productivity Theme from docs/ux-color-themes.html -->
    <colors>
      <color name="primary" hex="#5B5FC7" usage="Primary 버튼, 활성 상태"/>
      <color name="primary-hover" hex="#4F52B3" usage="Primary 버튼 호버"/>
      <color name="accent" hex="#3B82F6" usage="Accent, AI 관련, 링크"/>
      <color name="background" hex="#FAFAFA" usage="페이지 배경"/>
      <color name="surface" hex="#FFFFFF" usage="카드, 패널 배경"/>
      <color name="border" hex="#E4E4E7" usage="테두리"/>
      <color name="text-primary" hex="#18181B" usage="주요 텍스트"/>
      <color name="text-secondary" hex="#71717A" usage="보조 텍스트"/>
      <color name="success" hex="#22C55E" usage="성공 상태"/>
      <color name="warning" hex="#F59E0B" usage="경고 상태"/>
      <color name="error" hex="#EF4444" usage="에러, Destructive"/>
    </colors>
    <sidebar>
      <background>#18181B</background>
      <width>240px</width>
      <projectItem>프로젝트별 컬러 도트 + 이름</projectItem>
      <activeState>background: rgba(255,255,255,0.1)</activeState>
      <hoverState>background: rgba(255,255,255,0.05)</hoverState>
    </sidebar>
    <buttons>
      <primary>bg-[#5B5FC7] text-white hover:bg-[#4F52B3] rounded-lg px-4 py-2</primary>
      <secondary>bg-zinc-100 text-zinc-900 border border-zinc-200 hover:bg-zinc-200 rounded-lg px-4 py-2</secondary>
      <destructive>bg-red-500 text-white hover:bg-red-600 rounded-lg px-4 py-2</destructive>
    </buttons>
    <cards>
      <projectCard>bg-white border border-zinc-200 rounded-xl p-4 shadow-sm hover:shadow-md transition</projectCard>
    </cards>
    <forms>
      <input>border border-zinc-200 rounded-lg px-3 py-2 focus:border-[#5B5FC7] focus:ring-2 focus:ring-[#5B5FC7]/10</input>
      <label>text-sm font-medium text-zinc-700 mb-1.5</label>
      <error>text-xs text-red-500 mt-1</error>
    </forms>
  </uxTheme>
</story-context>
