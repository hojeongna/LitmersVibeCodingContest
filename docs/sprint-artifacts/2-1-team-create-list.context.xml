<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>2-1-team-create-list</storyId>
    <title>팀 생성 &amp; 목록 조회</title>
    <status>drafted</status>
    <generatedAt>2025-11-29</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-1-team-create-list.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>인증된 사용자</asA>
    <iWant>새로운 팀을 생성하고 내가 소속된 팀 목록을 조회</iWant>
    <soThat>협업 공간을 만들고 팀 간 전환을 통해 프로젝트를 관리할 수 있다</soThat>
    <tasks>
      <task id="1" part="A">팀 관련 TypeScript 타입 정의 (types/team.ts)</task>
      <task id="2" part="A">팀 API 구현 (app/api/teams/route.ts - POST, GET)</task>
      <task id="3" part="B">팀 생성 모달 컴포넌트 (components/teams/team-create-modal.tsx)</task>
      <task id="4" part="B">Sidebar 팀 목록 컴포넌트 (components/teams/team-list.tsx)</task>
      <task id="5" part="B">Sidebar 통합 (components/layout/sidebar.tsx)</task>
      <task id="6" part="C">팀 데이터 훅 구현 (hooks/use-teams.ts)</task>
      <task id="7" part="C">팀 컨텍스트 관리 (URL 기반)</task>
      <task id="8" part="D">팀 상세 페이지 스캐폴딩</task>
      <task id="9" part="E">Zod 스키마 정의 (lib/validations/team.ts)</task>
      <task id="10" part="F">E2E 테스트 시나리오</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1" fr="FR-010">팀 생성 모달에서 팀 이름(1~50자)을 입력하여 팀 생성 가능</ac>
    <ac id="2" fr="FR-010,FR-017">팀 생성 시 생성자가 자동으로 OWNER 역할로 team_members 테이블에 등록</ac>
    <ac id="3" fr="FR-010">팀 생성 후 Sidebar에 즉시 표시</ac>
    <ac id="4" fr="FR-010">한 사용자가 여러 팀에 소속 가능</ac>
    <ac id="5" fr="FR-010">Sidebar에서 팀 목록 표시 (팀 이름 + 컬러 도트)</ac>
    <ac id="6" fr="FR-010">팀 선택 시 해당 팀 컨텍스트로 전환</ac>
    <ac id="7" fr="FR-017">역할 체계(OWNER/ADMIN/MEMBER) 기반 구현</ac>
    <ac id="8" fr="FR-010">팀 이름이 비어있거나 50자 초과 시 에러 메시지 표시</ac>
    <ac id="9" fr="FR-010">API 응답 형식이 표준 포맷 준수 ({ success: true, data: {...} })</ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc type="story" path="docs/sprint-artifacts/2-1-team-create-list.md">Story 2.1 문서</doc>
      <doc type="ux-design" path="docs/ux-design-directions.html">UX 디자인 목업 (Team Management 화면 포함)</doc>
      <doc type="ux-theme" path="docs/ux-color-themes.html">Linear Productivity 테마 색상 및 컴포넌트</doc>
    </docs>
    <code>
      <!-- 기존 UI 컴포넌트 (shadcn/ui 기반) -->
      <file path="jira-lite-mvp/components/ui/button.tsx" type="component">
        <description>shadcn/ui Button 컴포넌트 - variant: default, destructive, outline, secondary, ghost, link / size: default, sm, lg, icon</description>
      </file>
      <file path="jira-lite-mvp/components/ui/input.tsx" type="component">
        <description>shadcn/ui Input 컴포넌트 - 기본 텍스트 입력</description>
      </file>
      <file path="jira-lite-mvp/components/ui/card.tsx" type="component">
        <description>shadcn/ui Card 컴포넌트 - Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter</description>
      </file>
      <file path="jira-lite-mvp/components/ui/label.tsx" type="component">
        <description>shadcn/ui Label 컴포넌트</description>
      </file>
      <file path="jira-lite-mvp/components/ui/dropdown-menu.tsx" type="component">
        <description>Radix UI DropdownMenu 컴포넌트</description>
      </file>

      <!-- Supabase 클라이언트 -->
      <file path="jira-lite-mvp/lib/supabase/client.ts" type="utility">
        <description>브라우저용 Supabase 클라이언트</description>
      </file>
      <file path="jira-lite-mvp/lib/supabase/server.ts" type="utility">
        <description>서버 컴포넌트/API용 Supabase 클라이언트</description>
      </file>
      <file path="jira-lite-mvp/lib/supabase/types.ts" type="types">
        <description>Supabase Database Types - Team, TeamMember, TeamRole 타입 포함</description>
        <existingTypes>
          <type name="Team">id, name, owner_id, created_at, updated_at, deleted_at</type>
          <type name="TeamMember">id, team_id, user_id, role: OWNER|ADMIN|MEMBER, joined_at</type>
          <type name="TeamRole">OWNER | ADMIN | MEMBER</type>
        </existingTypes>
      </file>
      <file path="jira-lite-mvp/lib/utils.ts" type="utility">
        <description>cn() 유틸리티 (clsx + tailwind-merge)</description>
      </file>

      <!-- 기존 인증 관련 -->
      <file path="jira-lite-mvp/components/login-form.tsx" type="component">
        <description>로그인 폼 - 참고용</description>
      </file>
      <file path="jira-lite-mvp/components/sign-up-form.tsx" type="component">
        <description>회원가입 폼 - 참고용</description>
      </file>
    </code>
    <dependencies>
      <runtime>
        <dep name="@tanstack/react-query" version="^5.90.11">데이터 페칭 및 캐싱</dep>
        <dep name="react-hook-form" version="^7.67.0">폼 상태 관리</dep>
        <dep name="@hookform/resolvers" version="^5.2.2">Zod resolver</dep>
        <dep name="zod" version="^4.1.13">유효성 검증</dep>
        <dep name="zustand" version="^5.0.8">전역 상태 관리 (선택)</dep>
        <dep name="@supabase/supabase-js" version="latest">Supabase 클라이언트</dep>
        <dep name="@supabase/ssr" version="latest">Supabase SSR</dep>
        <dep name="lucide-react" version="^0.511.0">아이콘</dep>
        <dep name="class-variance-authority" version="^0.7.1">cva 유틸</dep>
        <dep name="clsx" version="^2.1.1">클래스 조합</dep>
        <dep name="tailwind-merge" version="^3.3.0">Tailwind 클래스 머지</dep>
      </runtime>
      <dev>
        <dep name="tailwindcss" version="^3.4.1">Tailwind CSS</dep>
        <dep name="typescript" version="^5">TypeScript</dep>
      </dev>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="api-format">
      <description>모든 API 응답은 표준 포맷 준수</description>
      <example type="success">{ success: true, data: {...} }</example>
      <example type="error">{ success: false, error: { code: 'VALIDATION_ERROR', message: '...' } }</example>
    </constraint>
    <constraint type="naming">
      <rule>파일명: kebab-case (team-create-modal.tsx)</rule>
      <rule>컴포넌트: PascalCase (TeamCreateModal)</rule>
      <rule>함수/변수: camelCase (handleCreateTeam)</rule>
      <rule>DB 테이블: snake_case 복수 (teams, team_members)</rule>
      <rule>DB 컬럼: snake_case (created_at)</rule>
    </constraint>
    <constraint type="validation">
      <rule>팀 이름: 1~50자</rule>
      <rule>역할: OWNER, ADMIN, MEMBER 중 하나</rule>
    </constraint>
    <constraint type="security">
      <rule>모든 API에서 인증 확인 필수</rule>
      <rule>팀 멤버십 검증 필수 (FR-070)</rule>
      <rule>Soft Delete 사용 (deleted_at 필드)</rule>
    </constraint>
  </constraints>

  <interfaces>
    <api method="POST" path="/api/teams">
      <description>팀 생성</description>
      <request>
        <body>{ name: string }</body>
      </request>
      <response type="success">
        <body>{ success: true, data: { id, name, owner_id, created_at, updated_at } }</body>
      </response>
      <response type="error">
        <body>{ success: false, error: { code, message } }</body>
      </response>
    </api>
    <api method="GET" path="/api/teams">
      <description>내가 속한 팀 목록 조회</description>
      <response type="success">
        <body>{ success: true, data: [{ id, name, owner_id, created_at, role }] }</body>
      </response>
    </api>
    <types>
      <type name="Team" source="lib/supabase/types.ts">
        id: string
        name: string
        owner_id: string
        created_at: string
        updated_at: string
        deleted_at: string | null
      </type>
      <type name="TeamMember" source="lib/supabase/types.ts">
        id: string
        team_id: string
        user_id: string
        role: 'OWNER' | 'ADMIN' | 'MEMBER'
        joined_at: string
      </type>
      <type name="TeamWithRole" new="true">
        extends Team with role: TeamRole
      </type>
      <type name="CreateTeamInput" new="true">
        name: string (1-50 chars)
      </type>
    </types>
    <hooks>
      <hook name="useTeams">
        <return>TanStack Query useQuery result with TeamWithRole[]</return>
        <queryKey>['teams']</queryKey>
        <staleTime>30000</staleTime>
      </hook>
      <hook name="useCreateTeam">
        <return>TanStack Query useMutation result</return>
        <onSuccess>queryClient.invalidateQueries({ queryKey: ['teams'] })</onSuccess>
      </hook>
    </hooks>
  </interfaces>

  <uxDesign>
    <theme name="Linear Productivity">
      <colors mode="light">
        <color name="primary" hex="#5B5FC7" usage="Primary buttons, active states"/>
        <color name="primary-hover" hex="#4F52B3" usage="Button hover"/>
        <color name="accent" hex="#3B82F6" usage="Links, secondary actions"/>
        <color name="background" hex="#FAFAFA" usage="Page background"/>
        <color name="surface" hex="#FFFFFF" usage="Cards, panels"/>
        <color name="border" hex="#E4E4E7" usage="Borders, dividers"/>
        <color name="text-primary" hex="#18181B" usage="Main text"/>
        <color name="text-secondary" hex="#71717A" usage="Secondary text, labels"/>
        <color name="success" hex="#22C55E" usage="Success states"/>
        <color name="warning" hex="#F59E0B" usage="Warning states"/>
        <color name="error" hex="#EF4444" usage="Error states, destructive"/>
      </colors>
      <colors mode="dark">
        <color name="background" hex="#0F0F10" usage="Page background"/>
        <color name="surface" hex="#1A1A1D" usage="Cards, panels"/>
        <color name="surface-hover" hex="#242428" usage="Hover states"/>
        <color name="border" hex="#2E2E32" usage="Borders"/>
        <color name="text-primary" hex="#FAFAFA" usage="Main text"/>
        <color name="text-secondary" hex="#A1A1AA" usage="Secondary text"/>
      </colors>
      <typography>
        <font>Inter, -apple-system, BlinkMacSystemFont, sans-serif</font>
      </typography>
    </theme>
    <components>
      <component name="Sidebar">
        <description>Dark sidebar (#18181B) with team list, project list</description>
        <elements>
          <element>Logo + App name</element>
          <element>Team section label (uppercase, #71717A)</element>
          <element>Team list items (color dot + name)</element>
          <element>+ New Team button</element>
          <element>Active item highlight (primary color)</element>
        </elements>
      </component>
      <component name="TeamCreateModal">
        <description>Modal dialog for team creation</description>
        <elements>
          <element>Title: "Create Team"</element>
          <element>Close button (X)</element>
          <element>Team Name input (1-50 chars)</element>
          <element>Character count: 0/50</element>
          <element>Cancel button (secondary)</element>
          <element>Create Team button (primary)</element>
        </elements>
        <layout>
          Width: 420px
          Padding: 24px
          Border-radius: 16px
        </layout>
      </component>
      <component name="TeamListItem">
        <description>Single team item in sidebar</description>
        <elements>
          <element>Color dot (8px circle)</element>
          <element>Team name</element>
          <element>Active state highlight</element>
        </elements>
        <interactions>
          <hover>background: rgba(255,255,255,0.1)</hover>
          <active>background: primary color</active>
        </interactions>
      </component>
    </components>
  </uxDesign>

  <tests>
    <standards>
      <standard>E2E 테스트 시나리오 기반</standard>
      <standard>성공/실패 케이스 모두 테스트</standard>
    </standards>
    <locations>
      <location>jira-lite-mvp/__tests__/ (if exists)</location>
    </locations>
    <ideas>
      <scenario id="1" ac="1,2">팀 생성 성공 테스트 - 팀 생성 후 DB에 teams, team_members 레코드 확인</scenario>
      <scenario id="2" ac="8">팀 이름 유효성 검증 테스트 - 빈 값, 51자 초과시 에러</scenario>
      <scenario id="3" ac="3">팀 생성 후 Sidebar 반영 테스트 - 새로고침 없이 팀 표시</scenario>
      <scenario id="4" ac="6">팀 전환 테스트 - 팀 클릭 시 URL 변경 및 컨텍스트 전환</scenario>
      <scenario id="5" ac="4">여러 팀 소속 테스트 - 다른 팀 생성 후 모든 팀 목록 표시</scenario>
    </ideas>
  </tests>

  <workflow>
    <step order="1">팀 생성 워크플로우</step>
    <description>
      1. 사용자가 "+ New Team" 버튼 클릭
      2. TeamCreateModal 열림
      3. 팀 이름 입력 (1~50자 검증)
      4. "Create Team" 클릭
      5. POST /api/teams 호출
      6. 서버에서:
         - 인증 확인
         - 팀 이름 검증
         - INSERT teams (owner_id = 현재 사용자)
         - INSERT team_members (role = 'OWNER')
      7. 성공 응답
      8. 클라이언트에서:
         - 모달 닫기
         - 팀 목록 캐시 무효화 (자동 리페치)
         - 성공 Toast 표시
         - Sidebar에 새 팀 표시
    </description>
  </workflow>

  <database>
    <tables>
      <table name="teams">
        <column name="id" type="UUID" pk="true">gen_random_uuid()</column>
        <column name="name" type="VARCHAR(50)" nullable="false">1~50자</column>
        <column name="owner_id" type="UUID" fk="profiles.id" nullable="false"/>
        <column name="created_at" type="TIMESTAMPTZ" default="NOW()"/>
        <column name="updated_at" type="TIMESTAMPTZ" default="NOW()"/>
        <column name="deleted_at" type="TIMESTAMPTZ" nullable="true">Soft Delete</column>
      </table>
      <table name="team_members">
        <column name="id" type="UUID" pk="true">gen_random_uuid()</column>
        <column name="team_id" type="UUID" fk="teams.id" nullable="false"/>
        <column name="user_id" type="UUID" fk="profiles.id" nullable="false"/>
        <column name="role" type="VARCHAR(20)" nullable="false">CHECK (role IN ('OWNER', 'ADMIN', 'MEMBER'))</column>
        <column name="joined_at" type="TIMESTAMPTZ" default="NOW()"/>
        <constraint type="unique">UNIQUE(team_id, user_id)</constraint>
      </table>
    </tables>
  </database>

  <filesToCreate>
    <file path="jira-lite-mvp/types/team.ts" action="create">TypeScript 팀 타입 정의</file>
    <file path="jira-lite-mvp/app/api/teams/route.ts" action="create">팀 API (POST, GET)</file>
    <file path="jira-lite-mvp/components/teams/team-create-modal.tsx" action="create">팀 생성 모달</file>
    <file path="jira-lite-mvp/components/teams/team-list.tsx" action="create">Sidebar 팀 목록</file>
    <file path="jira-lite-mvp/components/layout/sidebar.tsx" action="create">Sidebar 레이아웃 (새로 생성 또는 수정)</file>
    <file path="jira-lite-mvp/hooks/use-teams.ts" action="create">팀 데이터 훅</file>
    <file path="jira-lite-mvp/lib/validations/team.ts" action="create">Zod 스키마</file>
    <file path="jira-lite-mvp/app/(dashboard)/teams/page.tsx" action="create">팀 선택 페이지</file>
    <file path="jira-lite-mvp/app/(dashboard)/teams/[teamId]/page.tsx" action="create">팀 상세 페이지</file>
  </filesToCreate>
</story-context>
