<story-context id="bmad/bmm/workflows/4-implementation/story-context" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>1</storyId>
    <title>칸반 보드 기본 UI</title>
    <status>drafted</status>
    <generatedAt>2025-11-29</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-1-kanban-board-basic-ui.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>프로젝트 팀 멤버</asA>
    <iWant>프로젝트의 모든 이슈를 상태별 컬럼으로 구분된 칸반 보드에서 확인</iWant>
    <soThat>현재 작업 진행 상황을 한눈에 파악하고 효율적으로 작업을 관리할 수 있다</soThat>
    <tasks>
      <part id="A" name="칸반 보드 라우트 및 레이아웃 설정">
        <task id="1" acs="1,5">칸반 보드 페이지 라우트 생성</task>
      </part>
      <part id="B" name="칸반 보드 컨테이너 컴포넌트">
        <task id="2" acs="1,2">KanbanBoard 컴포넌트 구현</task>
        <task id="3" acs="1,4,6">KanbanColumn 컴포넌트 구현</task>
      </part>
      <part id="C" name="이슈 카드 컴포넌트">
        <task id="4" acs="3,7">IssueCard 컴포넌트 구현</task>
        <task id="5" acs="3">PriorityBadge 컴포넌트 구현</task>
        <task id="6" acs="3">LabelTag 컴포넌트 구현</task>
      </part>
      <part id="D" name="이슈 상세 패널">
        <task id="7" acs="7">IssueDetailPanel 구현</task>
      </part>
      <part id="E" name="API 엔드포인트">
        <task id="8" acs="1,2">칸반 보드 데이터 API 구현</task>
        <task id="9" acs="4">프로젝트 상태 목록 API 구현</task>
      </part>
      <part id="F" name="타입 정의 및 유틸리티">
        <task id="10" acs="전체">칸반 관련 타입 정의</task>
      </part>
      <part id="G" name="반응형 및 스타일링">
        <task id="11" acs="8">반응형 레이아웃 구현</task>
      </part>
      <part id="H" name="테스트">
        <task id="12" acs="1-8">E2E 테스트 시나리오</task>
      </part>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1" fr="FR-050">프로젝트 페이지에서 Board 탭 클릭 시 상태별 컬럼이 표시된다</ac>
    <ac id="2" fr="FR-050">각 컬럼에 해당 상태의 이슈 카드가 올바르게 표시된다</ac>
    <ac id="3" fr="FR-050">이슈 카드에 ID, 제목, 우선순위, 라벨, 담당자, 마감일, 서브태스크 진행률이 표시된다</ac>
    <ac id="4" fr="FR-050">컬럼 헤더에 컬럼명과 이슈 개수가 표시된다</ac>
    <ac id="5" fr="FR-050">View Tabs (Board/List/Timeline)가 표시되고 Board 탭이 기본 선택된다</ac>
    <ac id="6" fr="FR-050">컬럼별 "+ Add Issue" 버튼이 표시된다</ac>
    <ac id="7" fr="FR-050">이슈 카드 클릭 시 상세 패널이 우측에 슬라이드로 열린다</ac>
    <ac id="8" fr="FR-050">반응형 레이아웃: 모바일에서 가로 스크롤로 모든 컬럼 접근 가능</ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/ux-design-specification.md" title="UX Design Specification" section="4.2 Key Screen Designs">
        칸반 보드 핵심 화면 디자인. Sidebar(240px) + Main Panel + Detail Panel(400px) 레이아웃.
        4개 기본 컬럼(Backlog, In Progress, Review, Done). 이슈 카드 규격 및 스타일 정의.
      </doc>
      <doc path="docs/ux-design-directions.html" title="Design Direction Mockups" section="Kanban Board">
        인터랙티브 UI 목업. 칸반 보드 전체 레이아웃, 이슈 카드 스타일, 상세 패널, View Tabs 시각적 참조.
        컬럼 색상: Backlog(#71717A), In Progress(#3B82F6), Review(#A855F7), Done(#22C55E).
      </doc>
      <doc path="docs/ux-color-themes.html" title="Color Theme Visualizer" section="Components">
        Linear Productivity 테마 색상. Priority Badge, Label Tag, Issue Card 컴포넌트 스타일 미리보기.
        다크모드 지원 참조.
      </doc>
      <doc path="docs/sprint-artifacts/tech-spec-epic-4.md" title="Epic 4 Technical Specification" section="Full">
        칸반 보드 & 댓글 기술 사양. 컴포넌트 구조, 데이터 모델, API 설계, 워크플로우 정의.
        @dnd-kit 기반 Drag & Drop 구현 가이드(Story 4.2에서 사용).
      </doc>
    </docs>
    <code>
      <file path="jira-lite-mvp/components/ui/card.tsx" kind="component" reason="이슈 카드 스타일링 기반 컴포넌트">shadcn/ui Card 컴포넌트 재사용</file>
      <file path="jira-lite-mvp/components/ui/badge.tsx" kind="component" reason="Priority Badge, Label Tag 기반">shadcn/ui Badge 컴포넌트 확장</file>
      <file path="jira-lite-mvp/components/ui/button.tsx" kind="component" reason="+ Add Issue 버튼 스타일">shadcn/ui Button 컴포넌트</file>
      <file path="jira-lite-mvp/lib/utils.ts" kind="utility" reason="cn() 함수 - Tailwind 클래스 병합">clsx + tailwind-merge 조합</file>
      <file path="jira-lite-mvp/tailwind.config.ts" kind="config" reason="색상 시스템 및 CSS 변수 정의">shadcn/ui 테마 설정</file>
      <file path="jira-lite-mvp/app/protected/layout.tsx" kind="layout" reason="인증된 페이지 레이아웃 참조">대시보드 레이아웃 확장점</file>
    </code>
    <dependencies>
      <npm>
        <package name="@dnd-kit/core" version="^6.3.1">Drag & Drop 코어 (Story 4.2에서 사용)</package>
        <package name="@dnd-kit/sortable" version="^10.0.0">정렬 가능한 리스트</package>
        <package name="@dnd-kit/utilities" version="^3.2.2">CSS 트랜스폼 유틸리티</package>
        <package name="@tanstack/react-query" version="^5.90.11">서버 상태 관리, 캐싱, Optimistic Updates</package>
        <package name="zustand" version="^5.0.8">UI 상태 관리 (선택된 이슈 등)</package>
        <package name="date-fns" version="^4.1.0">마감일 상대 시간 표시</package>
        <package name="lucide-react" version="^0.511.0">아이콘 (메뉴, 추가 버튼 등)</package>
      </npm>
      <shadcn-ui>
        <component name="Sheet">이슈 상세 패널 (우측 슬라이드)</component>
        <component name="Tabs">View Tabs (Board/List/Timeline)</component>
        <component name="Avatar">담당자 아바타</component>
        <component name="Skeleton">로딩 상태</component>
        <component name="DropdownMenu">컬럼 메뉴</component>
      </shadcn-ui>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="architecture">컴포넌트는 components/kanban/ 폴더에 생성</constraint>
    <constraint type="architecture">API Routes는 app/api/projects/[projectId]/ 하위에 생성</constraint>
    <constraint type="architecture">타입 정의는 types/kanban.ts에 생성</constraint>
    <constraint type="styling">Linear Productivity 테마 색상 준수 (Primary: #5B5FC7, Accent: #3B82F6)</constraint>
    <constraint type="styling">카드 규격: min-width 280px, max-width 320px, padding 12px, border-radius 8px</constraint>
    <constraint type="styling">컬럼 규격: min-width 280px, max-width 320px, overflow-y-auto</constraint>
    <constraint type="pattern">TanStack Query로 데이터 패칭 및 캐싱 (staleTime: 30초)</constraint>
    <constraint type="pattern">Zustand로 선택된 이슈 상태 관리</constraint>
    <constraint type="security">모든 API에서 팀 멤버십 검증 필수 (RLS 정책)</constraint>
    <constraint type="security">Soft Delete된 이슈 제외 (deleted_at IS NULL)</constraint>
    <constraint type="ux">터치 디바이스 최적화: 터치 타겟 44px 이상</constraint>
    <constraint type="ux">모바일(768px 이하): 가로 스크롤로 컬럼 탐색</constraint>
  </constraints>

  <interfaces>
    <interface name="GET /api/projects/[projectId]/board" kind="REST" path="app/api/projects/[projectId]/board/route.ts">
      <description>칸반 보드 데이터 조회 - statuses + issues 조인</description>
      <response>
        {
          success: true,
          data: {
            columns: Array&lt;{
              status: Status,
              issues: IssueCard[],
              issueCount: number
            }&gt;
          }
        }
      </response>
    </interface>
    <interface name="GET /api/projects/[projectId]/statuses" kind="REST" path="app/api/projects/[projectId]/statuses/route.ts">
      <description>프로젝트 상태 목록 조회 (position 순)</description>
      <response>
        {
          success: true,
          data: { statuses: Status[] }
        }
      </response>
    </interface>
    <interface name="Status" kind="TypeScript" path="types/kanban.ts">
      <signature>
        interface Status {
          id: string;
          project_id: string;
          name: string;
          color: string | null;
          position: number;
          wip_limit: number | null;
          is_default: boolean;
        }
      </signature>
    </interface>
    <interface name="IssueCard" kind="TypeScript" path="types/kanban.ts">
      <signature>
        interface IssueCard {
          id: string;
          title: string;
          status_id: string;
          priority: 'HIGH' | 'MEDIUM' | 'LOW';
          position: number;
          assignee: { id: string; name: string; avatar_url: string } | null;
          labels: { id: string; name: string; color: string }[];
          due_date: string | null;
          subtask_count: number;
          subtask_completed: number;
        }
      </signature>
    </interface>
    <interface name="KanbanColumn" kind="TypeScript" path="types/kanban.ts">
      <signature>
        interface KanbanColumn {
          status: Status;
          issues: IssueCard[];
          issueCount: number;
          isOverWipLimit: boolean;
        }
      </signature>
    </interface>
  </interfaces>

  <tests>
    <standards>
      프로젝트는 E2E 테스트 중심으로 Chrome DevTools MCP 또는 Playwright 사용.
      Unit 테스트는 Vitest + React Testing Library 사용 가능.
      테스트 파일은 __tests__ 폴더 또는 .test.ts 확장자 사용.
    </standards>
    <locations>
      <location>jira-lite-mvp/__tests__/</location>
      <location>jira-lite-mvp/**/*.test.ts</location>
      <location>jira-lite-mvp/**/*.test.tsx</location>
    </locations>
    <ideas>
      <idea ac="1">칸반 보드 페이지 로딩 시 4개 기본 컬럼 렌더링 확인</idea>
      <idea ac="2">이슈 카드가 올바른 컬럼(status_id 매칭)에 표시되는지 확인</idea>
      <idea ac="3">이슈 카드에 ID, 제목, 우선순위 배지, 라벨, 담당자 아바타, 마감일, 서브태스크 진행률 표시 확인</idea>
      <idea ac="4">각 컬럼 헤더에 컬럼명과 이슈 개수 배지 표시 확인</idea>
      <idea ac="5">View Tabs 렌더링 및 Board 탭 기본 active 상태 확인</idea>
      <idea ac="6">각 컬럼 하단에 "+ Add Issue" 버튼 존재 확인</idea>
      <idea ac="7">이슈 카드 클릭 시 우측 Sheet 패널이 슬라이드로 열리는지 확인</idea>
      <idea ac="8">768px 이하 뷰포트에서 가로 스크롤 동작 확인</idea>
    </ideas>
  </tests>

  <colorReference>
    <theme name="Linear Productivity">
      <color name="Primary" hex="#5B5FC7" usage="주요 버튼, 링크, 포커스 상태"/>
      <color name="Accent" hex="#3B82F6" usage="AI 기능, 강조 요소"/>
      <color name="Text Primary" hex="#18181B" usage="제목, 본문 텍스트"/>
      <color name="Text Secondary" hex="#71717A" usage="보조 텍스트, 메타 정보"/>
      <color name="Background" hex="#FAFAFA" usage="페이지 배경"/>
      <color name="Surface" hex="#FFFFFF" usage="카드, 모달 배경"/>
      <color name="Border" hex="#E4E4E7" usage="구분선, 테두리"/>
    </theme>
    <columnColors>
      <column name="Backlog" border="#71717A"/>
      <column name="In Progress" border="#3B82F6"/>
      <column name="Review" border="#A855F7"/>
      <column name="Done" border="#22C55E"/>
    </columnColors>
    <priorityColors>
      <priority level="HIGH" bg="#FEE2E2" text="#DC2626"/>
      <priority level="MEDIUM" bg="#FEF3C7" text="#D97706"/>
      <priority level="LOW" bg="#DCFCE7" text="#16A34A"/>
    </priorityColors>
    <labelColors>
      <label name="Bug" bg="#FEE2E2" text="#DC2626"/>
      <label name="Feature" bg="#DBEAFE" text="#2563EB"/>
      <label name="Enhancement" bg="#F3E8FF" text="#7C3AED"/>
      <label name="Docs" bg="#D1FAE5" text="#059669"/>
    </labelColors>
  </colorReference>

  <fileStructure>
    <newFiles>
      <file>app/(dashboard)/projects/[projectId]/board/page.tsx</file>
      <file>components/kanban/board.tsx</file>
      <file>components/kanban/column.tsx</file>
      <file>components/kanban/issue-card.tsx</file>
      <file>components/issues/issue-detail-panel.tsx</file>
      <file>components/issues/priority-badge.tsx</file>
      <file>components/issues/label-tag.tsx</file>
      <file>app/api/projects/[projectId]/board/route.ts</file>
      <file>app/api/projects/[projectId]/statuses/route.ts</file>
      <file>types/kanban.ts</file>
      <file>hooks/use-kanban.ts</file>
    </newFiles>
    <existingToModify>
      <file>필요시 app/protected/layout.tsx 확장 (Sidebar 통합)</file>
    </existingToModify>
  </fileStructure>

  <componentHierarchy>
    <component name="BoardPage" path="app/(dashboard)/projects/[projectId]/board/page.tsx">
      <component name="ViewTabs" path="shadcn/ui Tabs">Board/List/Timeline 탭</component>
      <component name="KanbanBoard" path="components/kanban/board.tsx">
        <component name="KanbanColumn" path="components/kanban/column.tsx" multiple="true">
          <component name="ColumnHeader">컬럼명, 이슈 개수, 메뉴</component>
          <component name="CardContainer">
            <component name="IssueCard" path="components/kanban/issue-card.tsx" multiple="true">
              <component name="IssueId">JL-42 형식</component>
              <component name="IssueTitle">제목 (최대 2줄)</component>
              <component name="PriorityBadge" path="components/issues/priority-badge.tsx"/>
              <component name="LabelTag" path="components/issues/label-tag.tsx" multiple="true"/>
              <component name="CardFooter">담당자, 마감일, 서브태스크</component>
            </component>
          </component>
          <component name="AddCardButton">+ Add Issue 버튼</component>
        </component>
      </component>
      <component name="IssueDetailPanel" path="components/issues/issue-detail-panel.tsx">
        Sheet 컴포넌트 기반 우측 슬라이드 패널
      </component>
    </component>
  </componentHierarchy>

  <dataFlow>
    Page Load → TanStack Query (useQuery) → GET /api/projects/[projectId]/board
    → Supabase: statuses + issues JOIN → KanbanColumn[] 렌더링
    → IssueCard Click → Zustand: setSelectedIssue → IssueDetailPanel Open
  </dataFlow>
</story-context>
