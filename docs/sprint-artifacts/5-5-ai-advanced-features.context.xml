<?xml version="1.0" encoding="UTF-8"?>
<story-context story="5-5-ai-advanced-features" generated="2025-11-29">
  <!-- Story Context for AI Advanced Features - Comment Summary -->

  <story-metadata>
    <title>AI ëŒ“ê¸€ ìš”ì•½ ë° ê³ ê¸‰ ê¸°ëŠ¥</title>
    <epic>Epic 5 - AI &amp; ëŒ€ì‹œë³´ë“œ &amp; ì•Œë¦¼</epic>
    <fr-coverage>FR-045</fr-coverage>
    <priority>P2</priority>
    <estimated-points>3</estimated-points>
  </story-metadata>

  <acceptance-criteria>
    <!-- FR-045: ëŒ“ê¸€ ìš”ì•½ -->
    <criterion id="AC-045-1">ëŒ“ê¸€ 3ê°œ ì´ìƒ ì‹œ "ëŒ“ê¸€ ìš”ì•½" ë²„íŠ¼ í‘œì‹œ</criterion>
    <criterion id="AC-045-2">ìš”ì•½ì— í•µì‹¬ í¬ì¸íŠ¸ ëª©ë¡ í¬í•¨</criterion>
    <criterion id="AC-045-3">ìš”ì•½ ê²°ê³¼ ë³µì‚¬ ê°€ëŠ¥</criterion>
    <criterion id="AC-045-4">ë¡œë”© ì¤‘ ìŠ¤í”¼ë„ˆ í‘œì‹œ</criterion>
    <criterion id="AC-045-5">Rate Limit ì ìš© (ë¶„ë‹¹ 10íšŒ, ì¼ë‹¹ 100íšŒ)</criterion>
  </acceptance-criteria>

  <technical-specification>
    <architecture>
      <decision id="ADR-005">API Route Handlers - AI í˜¸ì¶œì€ Route Handlerë¡œ êµ¬í˜„</decision>
      <decision id="ADR-006">Server-Side OpenAI - AI í˜¸ì¶œì€ ì„œë²„ì—ì„œë§Œ (API key ë³´í˜¸)</decision>
    </architecture>

    <api-endpoints>
      <endpoint method="POST" path="/api/ai/comment-summary">
        <description>ëŒ“ê¸€ ìŠ¤ë ˆë“œ ìš”ì•½ (FR-045)</description>
        <request>
          <![CDATA[
{
  issue_id: string
}
          ]]>
        </request>
        <response>
          <![CDATA[
// Success
{
  success: true,
  data: {
    summary: string,           // ì „ì²´ ìš”ì•½
    key_points: string[],      // í•µì‹¬ í¬ì¸íŠ¸ ëª©ë¡
    comment_count: number,     // ìš”ì•½ëœ ëŒ“ê¸€ ìˆ˜
    generated_at: string
  }
}

// Error
{
  success: false,
  error: {
    code: 'NOT_ENOUGH_COMMENTS' | 'RATE_LIMIT_EXCEEDED' | 'AI_ERROR',
    message: string
  }
}
          ]]>
        </response>
        <constraints>
          <item>ëŒ“ê¸€ 3ê°œ ì´ìƒ í•„ìš”</item>
          <item>Rate Limit: ë¶„ë‹¹ 10íšŒ, ì¼ë‹¹ 100íšŒ</item>
        </constraints>
      </endpoint>
    </api-endpoints>

    <data-models>
      <model name="comments">
        <description>ëŒ“ê¸€ í…Œì´ë¸” (ì´ë¯¸ ìŠ¤í‚¤ë§ˆì— ì¡´ì¬)</description>
        <columns>
          <column name="id" type="UUID" primary="true"/>
          <column name="issue_id" type="UUID" references="issues.id"/>
          <column name="author_id" type="UUID" references="profiles.id"/>
          <column name="content" type="TEXT"/>
          <column name="created_at" type="TIMESTAMPTZ"/>
          <column name="updated_at" type="TIMESTAMPTZ"/>
          <column name="deleted_at" type="TIMESTAMPTZ" nullable="true"/>
        </columns>
      </model>

      <model name="ai_cache">
        <description>AI ê²°ê³¼ ìºì‹± (ëŒ“ê¸€ ìš”ì•½ ìºì‹±)</description>
        <cache-key>issue_id + comment_count + latest_comment_id</cache-key>
        <cache-ttl>ëŒ“ê¸€ ì¶”ê°€ ì‹œ ë¬´íš¨í™”</cache-ttl>
      </model>
    </data-models>
  </technical-specification>

  <implementation-guide>
    <file-structure>
      <![CDATA[
jira-lite-mvp/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ ai/
â”‚           â””â”€â”€ comment-summary/
â”‚               â””â”€â”€ route.ts        # POST /api/ai/comment-summary
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ai/
â”‚       â”œâ”€â”€ CommentSummary.tsx      # ëŒ“ê¸€ ìš”ì•½ íŒ¨ë„
â”‚       â””â”€â”€ CommentSummaryButton.tsx # ëŒ“ê¸€ ìš”ì•½ ë²„íŠ¼
â””â”€â”€ lib/
    â””â”€â”€ ai/
        â””â”€â”€ prompts.ts              # COMMENT_SUMMARY í”„ë¡¬í”„íŠ¸ ì¶”ê°€
      ]]>
    </file-structure>

    <component-specs>
      <component name="CommentSummaryButton">
        <location>components/ai/CommentSummaryButton.tsx</location>
        <props>
          <![CDATA[
interface CommentSummaryButtonProps {
  issueId: string
  commentCount: number
  disabled?: boolean
}
          ]]>
        </props>
        <features>
          <item>ëŒ“ê¸€ 3ê°œ ë¯¸ë§Œ ì‹œ ë¹„í™œì„±í™” + íˆ´íŒ</item>
          <item>AI ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ê·¸ë¼ë””ì–¸íŠ¸)</item>
          <item>ë¡œë”© ìƒíƒœ (ìŠ¤í”¼ë„ˆ)</item>
          <item>í´ë¦­ ì‹œ CommentSummary ëª¨ë‹¬/íŒ¨ë„ ì—´ê¸°</item>
        </features>
      </component>

      <component name="CommentSummary">
        <location>components/ai/CommentSummary.tsx</location>
        <props>
          <![CDATA[
interface CommentSummaryProps {
  issueId: string
  isOpen: boolean
  onClose: () => void
}
          ]]>
        </props>
        <features>
          <item>ìš”ì•½ í…ìŠ¤íŠ¸ í‘œì‹œ</item>
          <item>í•µì‹¬ í¬ì¸íŠ¸ ëª©ë¡ (ë¶ˆë¦¿ í¬ì¸íŠ¸)</item>
          <item>ìš”ì•½ëœ ëŒ“ê¸€ ìˆ˜ í‘œì‹œ</item>
          <item>ë³µì‚¬ ë²„íŠ¼</item>
          <item>ì¬ìƒì„± ë²„íŠ¼</item>
          <item>ë¡œë”©/ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬</item>
        </features>
      </component>
    </component-specs>

    <code-samples>
      <sample name="comment-summary-prompt">
        <![CDATA[
// lib/ai/prompts.ts
export const PROMPTS = {
  // ... ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ë“¤

  COMMENT_SUMMARY: `You are a discussion summarizer for software issue tracking.
Analyze the comment thread and provide:
1. A brief overall summary (2-3 sentences)
2. Key discussion points as a bullet list (3-5 items)

Focus on:
- Decisions made
- Questions raised
- Solutions proposed
- Action items mentioned

Return JSON format:
{
  "summary": "Overall summary of the discussion...",
  "key_points": ["Point 1", "Point 2", ...]
}

Write in Korean.`
}
        ]]>
      </sample>

      <sample name="api-route-comment-summary">
        <![CDATA[
// app/api/ai/comment-summary/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { openai } from '@/lib/ai/openai-client'
import { checkRateLimit, recordUsage } from '@/lib/ai/rate-limiter'
import { PROMPTS } from '@/lib/ai/prompts'

export async function POST(request: NextRequest) {
  try {
    const supabase = await createClient()
    const { data: { user } } = await supabase.auth.getUser()

    if (!user) {
      return NextResponse.json(
        { success: false, error: { code: 'UNAUTHORIZED', message: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' } },
        { status: 401 }
      )
    }

    // Rate limit check
    const canProceed = await checkRateLimit(user.id)
    if (!canProceed) {
      return NextResponse.json(
        { success: false, error: { code: 'RATE_LIMIT_EXCEEDED', message: 'AI ì‚¬ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤' } },
        { status: 429 }
      )
    }

    const { issue_id } = await request.json()

    // Fetch comments
    const { data: comments, error: commentsError } = await supabase
      .from('comments')
      .select(`
        id,
        content,
        created_at,
        author:profiles!author_id(name)
      `)
      .eq('issue_id', issue_id)
      .is('deleted_at', null)
      .order('created_at', { ascending: true })

    if (commentsError || !comments) {
      return NextResponse.json(
        { success: false, error: { code: 'NOT_FOUND', message: 'ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' } },
        { status: 404 }
      )
    }

    // Check minimum comment count
    if (comments.length < 3) {
      return NextResponse.json(
        { success: false, error: { code: 'NOT_ENOUGH_COMMENTS', message: 'ëŒ“ê¸€ì´ 3ê°œ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤' } },
        { status: 400 }
      )
    }

    // Format comments for AI
    const formattedComments = comments.map((c, i) =>
      `[${i + 1}] ${c.author?.name || 'ìµëª…'}: ${c.content}`
    ).join('\n\n')

    // Generate summary
    const response = await openai.chat.completions.create({
      model: 'gpt-4o-mini',
      messages: [
        { role: 'system', content: PROMPTS.COMMENT_SUMMARY },
        { role: 'user', content: `Comment Thread:\n\n${formattedComments}` }
      ],
      max_tokens: 500,
      temperature: 0.7,
      response_format: { type: 'json_object' }
    })

    const result = JSON.parse(response.choices[0].message.content || '{}')

    // Record usage
    await recordUsage(user.id, 'comment_summary')

    return NextResponse.json({
      success: true,
      data: {
        summary: result.summary || '',
        key_points: result.key_points || [],
        comment_count: comments.length,
        generated_at: new Date().toISOString()
      }
    })

  } catch (error) {
    console.error('Comment Summary Error:', error)
    return NextResponse.json(
      { success: false, error: { code: 'AI_ERROR', message: 'ëŒ“ê¸€ ìš”ì•½ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' } },
      { status: 500 }
    )
  }
}
        ]]>
      </sample>

      <sample name="comment-summary-component">
        <![CDATA[
// components/ai/CommentSummary.tsx
'use client'

import { useState } from 'react'
import { Copy, RefreshCw, Sparkles, X } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { AIButton } from '@/components/ui/ai-button'
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
} from '@/components/ui/sheet'
import { toast } from 'sonner'

interface CommentSummaryProps {
  issueId: string
  isOpen: boolean
  onClose: () => void
}

interface SummaryResult {
  summary: string
  key_points: string[]
  comment_count: number
}

export function CommentSummary({ issueId, isOpen, onClose }: CommentSummaryProps) {
  const [loading, setLoading] = useState(false)
  const [result, setResult] = useState<SummaryResult | null>(null)
  const [error, setError] = useState<string | null>(null)

  const generateSummary = async () => {
    setLoading(true)
    setError(null)

    try {
      const response = await fetch('/api/ai/comment-summary', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ issue_id: issueId })
      })

      const data = await response.json()

      if (!response.ok) {
        throw new Error(data.error?.message || 'ìš”ì•½ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤')
      }

      setResult(data.data)
    } catch (err) {
      setError(err instanceof Error ? err.message : 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤')
    } finally {
      setLoading(false)
    }
  }

  const copyToClipboard = () => {
    if (!result) return

    const text = `## ëŒ“ê¸€ ìš”ì•½\n\n${result.summary}\n\n### í•µì‹¬ í¬ì¸íŠ¸\n${result.key_points.map(p => `- ${p}`).join('\n')}`
    navigator.clipboard.writeText(text)
    toast.success('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤')
  }

  // íŒ¨ë„ ì—´ë¦´ ë•Œ ìë™ ìƒì„±
  useState(() => {
    if (isOpen && !result) {
      generateSummary()
    }
  })

  return (
    <Sheet open={isOpen} onOpenChange={(open) => !open && onClose()}>
      <SheetContent className="w-[400px] sm:w-[540px]">
        <SheetHeader>
          <SheetTitle className="flex items-center gap-2">
            <Sparkles className="h-5 w-5 text-primary" />
            ëŒ“ê¸€ ìš”ì•½
          </SheetTitle>
        </SheetHeader>

        <div className="mt-6">
          {loading && (
            <div className="flex flex-col items-center justify-center py-12">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
              <p className="mt-4 text-sm text-zinc-500">ëŒ“ê¸€ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
          )}

          {error && (
            <div className="bg-red-50 border border-red-200 rounded-lg p-4">
              <p className="text-red-700">{error}</p>
              <Button
                variant="outline"
                size="sm"
                onClick={generateSummary}
                className="mt-3"
              >
                ë‹¤ì‹œ ì‹œë„
              </Button>
            </div>
          )}

          {result && !loading && (
            <div className="space-y-6">
              {/* Summary */}
              <div className="ai-panel p-4 rounded-lg">
                <h4 className="font-medium text-zinc-700 mb-2">ì „ì²´ ìš”ì•½</h4>
                <p className="text-sm text-zinc-600 leading-relaxed">
                  {result.summary}
                </p>
              </div>

              {/* Key Points */}
              <div>
                <h4 className="font-medium text-zinc-700 mb-2">í•µì‹¬ í¬ì¸íŠ¸</h4>
                <ul className="space-y-2">
                  {result.key_points.map((point, index) => (
                    <li key={index} className="flex items-start gap-2 text-sm text-zinc-600">
                      <span className="text-primary mt-1">â€¢</span>
                      {point}
                    </li>
                  ))}
                </ul>
              </div>

              {/* Meta */}
              <div className="text-xs text-zinc-400">
                {result.comment_count}ê°œì˜ ëŒ“ê¸€ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤
              </div>

              {/* Actions */}
              <div className="flex gap-2">
                <Button
                  variant="outline"
                  size="sm"
                  onClick={copyToClipboard}
                >
                  <Copy className="h-4 w-4 mr-1" />
                  ë³µì‚¬
                </Button>
                <Button
                  variant="outline"
                  size="sm"
                  onClick={generateSummary}
                  disabled={loading}
                >
                  <RefreshCw className="h-4 w-4 mr-1" />
                  ì¬ìƒì„±
                </Button>
              </div>
            </div>
          )}
        </div>
      </SheetContent>
    </Sheet>
  )
}
        ]]>
      </sample>

      <sample name="comment-summary-button">
        <![CDATA[
// components/ai/CommentSummaryButton.tsx
'use client'

import { useState } from 'react'
import { MessageSquare, Sparkles } from 'lucide-react'
import { AIButton } from '@/components/ui/ai-button'
import { CommentSummary } from './CommentSummary'
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip'

interface CommentSummaryButtonProps {
  issueId: string
  commentCount: number
}

export function CommentSummaryButton({ issueId, commentCount }: CommentSummaryButtonProps) {
  const [isOpen, setIsOpen] = useState(false)
  const isDisabled = commentCount < 3

  return (
    <>
      <TooltipProvider>
        <Tooltip>
          <TooltipTrigger asChild>
            <div>
              <AIButton
                size="sm"
                onClick={() => setIsOpen(true)}
                disabled={isDisabled}
              >
                <MessageSquare className="h-4 w-4" />
                ëŒ“ê¸€ ìš”ì•½
              </AIButton>
            </div>
          </TooltipTrigger>
          {isDisabled && (
            <TooltipContent>
              <p>ëŒ“ê¸€ì´ 3ê°œ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤ ({commentCount}/3)</p>
            </TooltipContent>
          )}
        </Tooltip>
      </TooltipProvider>

      <CommentSummary
        issueId={issueId}
        isOpen={isOpen}
        onClose={() => setIsOpen(false)}
      />
    </>
  )
}
        ]]>
      </sample>
    </code-samples>
  </implementation-guide>

  <ux-design-reference>
    <design-system>
      <framework>shadcn/ui + Tailwind CSS + Radix UI</framework>
      <icons>Lucide Icons</icons>
    </design-system>

    <color-theme name="Linear Productivity">
      <primary>#5B5FC7 (Indigo)</primary>
      <accent>#3B82F6 (Blue)</accent>
      <ai-gradient>linear-gradient(135deg, #5B5FC7 0%, #3B82F6 100%)</ai-gradient>
    </color-theme>

    <comment-summary-panel-design>
      <![CDATA[
<!-- ëŒ“ê¸€ ìš”ì•½ íŒ¨ë„ (Sheet) -->
+------------------------------------------+
| âœ¨ ëŒ“ê¸€ ìš”ì•½                         [X] |
+------------------------------------------+
|                                          |
| ## ì „ì²´ ìš”ì•½                             |
| +--------------------------------------+ |
| | ì´ ë…¼ì˜ì—ì„œëŠ” ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ì—     | |
| | ëŒ€í•´ ë…¼ì˜í–ˆìŠµë‹ˆë‹¤. OAuthì™€ JWTë¥¼    | |
| | ë¹„êµí•˜ê³  JWTë¥¼ ì„ íƒí•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. | |
| +--------------------------------------+ |
|                                          |
| ## í•µì‹¬ í¬ì¸íŠ¸                           |
| â€¢ JWT í† í° ë°©ì‹ ì„ íƒ ê²°ì •                |
| â€¢ ë¦¬í”„ë ˆì‹œ í† í° êµ¬í˜„ í•„ìš”                |
| â€¢ ë³´ì•ˆ ê²€í†  ìš”ì²­ë¨                       |
| â€¢ ë§ˆê°ì¼: ë‹¤ìŒ ì£¼ ê¸ˆìš”ì¼                 |
|                                          |
| 12ê°œì˜ ëŒ“ê¸€ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤               |
|                                          |
| [ğŸ“‹ ë³µì‚¬]  [ğŸ”„ ì¬ìƒì„±]                   |
+------------------------------------------+
      ]]>
    </comment-summary-panel-design>

    <button-disabled-state>
      <![CDATA[
<!-- ëŒ“ê¸€ 3ê°œ ë¯¸ë§Œ ì‹œ ë¹„í™œì„±í™” + íˆ´íŒ -->
.ai-button-disabled {
  background: #e4e4e7;
  color: #a1a1aa;
  cursor: not-allowed;
  opacity: 0.6;
}

// íˆ´íŒ: "ëŒ“ê¸€ì´ 3ê°œ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤ (1/3)"
      ]]>
    </button-disabled-state>

    <key-points-style>
      <![CDATA[
.key-points-list {
  list-style: none;
  padding: 0;
}

.key-points-list li {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 8px 0;
  font-size: 0.875rem;
  color: #3f3f46;
}

.key-points-list li::before {
  content: 'â€¢';
  color: #5B5FC7;
  font-size: 1.2em;
  line-height: 1;
}
      ]]>
    </key-points-style>
  </ux-design-reference>

  <existing-codebase>
    <relevant-files>
      <file path="jira-lite-mvp/components/ui/ai-button.tsx">
        <description>AI ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ (ê·¸ë¼ë””ì–¸íŠ¸ ìŠ¤íƒ€ì¼, ë¡œë”© ìƒíƒœ)</description>
      </file>
      <file path="jira-lite-mvp/components/ui/sheet.tsx">
        <description>Sheet (ìŠ¬ë¼ì´ë“œ íŒ¨ë„) ì»´í¬ë„ŒíŠ¸</description>
      </file>
      <file path="jira-lite-mvp/components/ui/tooltip.tsx">
        <description>íˆ´íŒ ì»´í¬ë„ŒíŠ¸</description>
      </file>
      <file path="jira-lite-mvp/lib/ai/rate-limiter.ts">
        <description>Rate Limiter (Story 5-2ì—ì„œ êµ¬í˜„)</description>
      </file>
      <file path="jira-lite-mvp/lib/ai/openai-client.ts">
        <description>OpenAI í´ë¼ì´ì–¸íŠ¸ (Story 5-1ì—ì„œ êµ¬í˜„)</description>
      </file>
      <file path="jira-lite-mvp/lib/supabase/types.ts">
        <description>DB íƒ€ì… ì •ì˜ (comments í…Œì´ë¸” í¬í•¨)</description>
      </file>
    </relevant-files>

    <existing-types>
      <![CDATA[
// lib/supabase/types.tsì—ì„œ ë°œì·Œ
export type Comment = Tables<'comments'>
// {
//   id: string
//   issue_id: string
//   author_id: string
//   content: string
//   created_at: string
//   updated_at: string
//   deleted_at: string | null
// }

export type AiCacheType = 'summary' | 'suggestion' | 'comment_summary'
      ]]>
    </existing-types>
  </existing-codebase>

  <dependencies>
    <npm-packages>
      <package name="openai" version="^6.9.1">OpenAI API í´ë¼ì´ì–¸íŠ¸</package>
    </npm-packages>

    <story-dependencies>
      <dependency story="5-1">OpenAI í´ë¼ì´ì–¸íŠ¸ ì„¤ì •</dependency>
      <dependency story="5-2">Rate Limiter êµ¬í˜„</dependency>
    </story-dependencies>
  </dependencies>

  <testing-guidance>
    <unit-tests>
      <test>ëŒ“ê¸€ í¬ë§·íŒ… í•¨ìˆ˜ê°€ ì˜¬ë°”ë¥¸ í˜•ì‹ìœ¼ë¡œ ë³€í™˜</test>
      <test>ëŒ“ê¸€ 3ê°œ ë¯¸ë§Œ ì‹œ NOT_ENOUGH_COMMENTS ì—ëŸ¬</test>
      <test>ìš”ì•½ ê²°ê³¼ê°€ JSON í˜•ì‹ìœ¼ë¡œ íŒŒì‹±ë¨</test>
    </unit-tests>

    <integration-tests>
      <test>POST /api/ai/comment-summary - ìœ íš¨í•œ ì´ìŠˆì— ëŒ€í•´ ìš”ì•½ ìƒì„±</test>
      <test>POST /api/ai/comment-summary - ëŒ“ê¸€ 3ê°œ ë¯¸ë§Œ ì‹œ 400 ì—ëŸ¬</test>
      <test>POST /api/ai/comment-summary - Rate Limit ì´ˆê³¼ ì‹œ 429 ì—ëŸ¬</test>
      <test>ìš”ì•½ì— summaryì™€ key_points í¬í•¨</test>
    </integration-tests>

    <e2e-scenarios>
      <scenario>ì´ìŠˆ ìƒì„¸ â†’ ëŒ“ê¸€ ìš”ì•½ ë²„íŠ¼ í´ë¦­ â†’ íŒ¨ë„ ì—´ë¦¼ â†’ ìš”ì•½ í‘œì‹œ</scenario>
      <scenario>ë³µì‚¬ ë²„íŠ¼ í´ë¦­ â†’ í´ë¦½ë³´ë“œì— ìš”ì•½ ë³µì‚¬</scenario>
      <scenario>ì¬ìƒì„± ë²„íŠ¼ í´ë¦­ â†’ ìƒˆ ìš”ì•½ ìƒì„±</scenario>
      <scenario>ëŒ“ê¸€ 3ê°œ ë¯¸ë§Œ â†’ ë²„íŠ¼ ë¹„í™œì„±í™” + íˆ´íŒ í‘œì‹œ</scenario>
    </e2e-scenarios>
  </testing-guidance>

  <integration-points>
    <![CDATA[
// ì´ìŠˆ ìƒì„¸ í˜ì´ì§€ì—ì„œ CommentSummaryButton í†µí•©

// app/(dashboard)/projects/[projectId]/issues/[issueId]/page.tsx
import { CommentSummaryButton } from '@/components/ai/CommentSummaryButton'

export default function IssuePage({ params }) {
  // ... ì´ìŠˆ ë° ëŒ“ê¸€ ë¡œë”©

  return (
    <div>
      {/* ì´ìŠˆ ìƒì„¸ */}
      <IssueDetail issue={issue} />

      {/* ëŒ“ê¸€ ì„¹ì…˜ */}
      <div className="mt-8">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-semibold">ëŒ“ê¸€ ({comments.length})</h3>
          <CommentSummaryButton
            issueId={issue.id}
            commentCount={comments.length}
          />
        </div>
        <CommentList comments={comments} />
      </div>
    </div>
  )
}
    ]]>
  </integration-points>

  <notes>
    <note priority="high">ëŒ“ê¸€ì´ ë§ì„ìˆ˜ë¡ AI í† í° ì‚¬ìš©ëŸ‰ ì¦ê°€ - ìµœëŒ€ 50ê°œ ì œí•œ ê³ ë ¤</note>
    <note priority="high">ì‚­ì œëœ ëŒ“ê¸€(deleted_at NOT NULL)ì€ ìš”ì•½ì—ì„œ ì œì™¸</note>
    <note priority="medium">ìºì‹±: ë™ì¼ ëŒ“ê¸€ êµ¬ì„± ì‹œ ê¸°ì¡´ ìš”ì•½ ë°˜í™˜</note>
    <note priority="medium">ë³µì‚¬ ì‹œ Markdown í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…</note>
    <note priority="low">v2: íŠ¹ì • ì‹œê°„ ë²”ìœ„ ëŒ“ê¸€ë§Œ ìš”ì•½í•˜ëŠ” ê¸°ëŠ¥</note>
  </notes>
</story-context>
